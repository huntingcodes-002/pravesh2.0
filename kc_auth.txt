This document provides detailed information about the authentication-related API endpoints in the Base module. These endpoints proxy requests to an external Keycloak-based authentication server.

Authentication Flow
The authentication flow consists of the following steps:

Login (/api/token/login-pravesh/) - Authenticate with username/password
Verify OTP (/api/token/verify-otp/) - Verify the OTP and receive tokens
Refresh Token (/api/token/refresh-token/) - Refresh expired access tokens
User Profile (/api/token/user-profile/) - Get authenticated user profile
Forgot Password (/api/token/forgotpassword/) - Initiate password reset
Logout (/api/token/logout/) - Log out and invalidate session
Resend OTP (/api/token/resend-otp/) - Resend OTP to user's phone






Authentication Endpoints:



1. Pravesh Login
Endpoint: POST /api/token/login-pravesh/
View: AuthLoginView
Authentication: None required
Description: Direct credential login for Pravesh flow. Authenticates user with username/password and redirects to OTP generation.

Request Body
{
  "username": "user@example.com",
  "password": "userpassword"
}
Success Response (302 Redirect)
Redirects to: /api/auth/otp/?phone_number={phone}&email={email}&employee_user_name={name}

Error Responses
400 Bad Request - Missing Credentials

{
  "status": "error",
  "message": "Username and password are required"
}
500 Internal Server Error - Auth Server Response Returns the error response from the authentication server with the same status code.



2. Verify OTP
Endpoint: POST /api/token/verify-otp/
View: VerifyOTPView
Authentication: None required
Description: Verifies the OTP sent to the user's phone number. OTPs are valid for 10 minutes with up to 3 retries.

Request Body
{
  "otp": "123456",
  "verification_code": "gAAAAABh..."
}
Success Response (200)
{
  "success": true,
  "message": "OTP verified successfully",
  "data": {
    "expires_in": 14400,
    "refresh_expires_in": 288000,
    "refresh_token": "eyJhbGciOiJIUzUxMiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICIzYjZlNTI4YS00MjE2LTQ0ODItYWM3Ni01OWZiMGJhMmM5MDkifQ...",
    "token_type": "Bearer",
    "id_token": "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJPdU1tUDJXd2JzYVlnX0xoVy1GdU1TYTIzSi1kUXZUdl9CQnlPeFRCMmxzIn0...",
    "not-before-policy": 0,
    "session_state": "9f2afedb-1c6b-4593-8192-f99807e96ebd",
    "scope": "openid email profile"
  }
}
Note: The access_token is not included in the response as it is cached server-side and associated with the id_token. Use the id_token in the Authorization header for subsequent authenticated requests.

Error Responses
400 Bad Request - Missing Required Fields

{
  "status": "error",
  "message": "OTP and verification code are required"
}
500 Internal Server Error - Auth Server Error

{
  "status": "error",
  "message": "Error message from auth server"
}
500 Internal Server Error - Missing Tokens

{
  "status": "error",
  "message": "Failed to get tokens"
}



3. Refresh Token
Endpoint: POST /api/token/refresh-token/
View: RefreshTokenView
Authentication: Required (Refresh token in Authorization header)
Description: Refreshes an expired access token using a valid refresh token sent in the Authorization header.

Request Headers
Authorization: {refresh_token}
Note: Send the refresh token without the Bearer prefix in the Authorization header.

Success Response (200)
{
  "success": true,
  "message": "Refresh token refreshed successfully",
  "data": {
    "expires_in": 14400,
    "refresh_expires_in": 288000,
    "refresh_token": "eyJhbGciOiJIUzUxMiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICIzYjZlNTI4YS00MjE2LTQ0ODItYWM3Ni01OWZiMGJhMmM5MDkifQ...",
    "token_type": "Bearer",
    "id_token": "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJPdU1tUDJXd2JzYVlnX0xoVy1GdU1TYTIzSi1kUXZUdl9CQnlPeFRCMmxzIn0...",
    "not-before-policy": 0,
    "session_state": "9f2afedb-1c6b-4593-8192-f99807e96ebd",
    "scope": "openid email profile"
  }
}
Note: The access_token is not included in the response as it is cached server-side and associated with the id_token. Use the id_token in the Authorization header for subsequent authenticated requests.

Error Responses
400 Bad Request - Missing Refresh Token

{
  "status": "error",
  "message": "Refresh token is required"
}
500 Internal Server Error - Auth Server Error

{
  "status": "error",
  "message": "Error message from auth server"
}
500 Internal Server Error - Missing Tokens

{
  "status": "error",
  "message": "Failed to get tokens"
}



4. User Profile
Endpoint: GET /api/token/user-profile/
View: UserProfileView
Authentication: Required (ID token in Authorization header)
Description: Returns the authenticated user's profile information from the KeycloakUser model.

Request Headers
Authorization: Bearer {id_token}
Success Response (200)
Returns the user profile data from the authentication server. The response structure depends on the authentication server's response format.

Error Responses
401 Unauthorized - Missing or Invalid Token

{
  "status": "error",
  "message": "Unauthorized"
}
Other Error Responses Returns the error response from the authentication server with the same status code.



5. Forgot Password
Endpoint: POST /api/token/forgotpassword/
View: ForgotPasswordView
Authentication: None required
Description: Initiates a password reset flow by sending a reset link or code to the user's email.

Request Body
{
  "email": "user@example.com"
}
Success Response
Returns the response from the authentication server with the same status code. The response structure depends on the authentication server's implementation.

Error Responses
400 Bad Request - Missing Email

{
  "status": "error",
  "message": "Email is required"
}
Other Error Responses Returns the error response from the authentication server with the same status code.



6. Logout
Endpoint: GET /api/token/logout/
View: LogoutView
Authentication: Required (ID token in Authorization header)
Description: Logs out the user by invalidating the session and clearing cached tokens.

Request Headers
Authorization: Bearer {id_token}
Success Response
Returns the response from the authentication server with the same status code. The response structure depends on the authentication server's implementation.

Error Responses
Returns the error response from the authentication server with the same status code.



7. Resend OTP
Endpoint: POST /api/token/resend-otp/
View: ResendOTPView
Authentication: None required
Description: Resends the OTP to the user's phone number using the verification code from the initial login request.

Request Body
{
  "verification_code": "gAAAAABh..."
}
Success Response
Returns the response from the authentication server with the same status code. The response structure depends on the authentication server's implementation.

Error Responses
400 Bad Request - Missing Verification Code

{
  "status": "error",
  "message": "Verification code is required"
}
Other Error Responses Returns the error response from the authentication server with the same status code.